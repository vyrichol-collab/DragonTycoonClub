<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DRAGON TYCOON CLUB // QUEST</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000000;
            --text-main: #ffffff;
            --text-dim: #bbbbbb;
            --text-success: #00ff41;
            --text-error: #ff0055;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        html, body {
            background: var(--bg);
            min-height: 100%;
            overflow-x: hidden;
            /* Убираем прыжки при появлении клавиатуры */
            height: -webkit-fill-available;
        }

        body {
            color: var(--text-dim);
            font-family: 'Space Mono', monospace;
            font-size: 13px;
            line-height: 1.5;
            padding: 20px 20px 100px 20px; /* Большой отступ снизу чтобы текст не прятался за клавиатурой */
            display: flex;
            flex-direction: column;
        }

        .terminal-container {
            width: 100%;
        }

        .line {
            margin-bottom: 4px;
            word-wrap: break-word;
            white-space: pre-wrap;
            display: block;
        }

        .prompt-line {
            color: var(--text-main);
            display: block;
            margin-top: 8px;
        }

        .active-input {
            display: inline;
            border-right: 8px solid var(--text-main);
            animation: blink 0.9s step-end infinite;
            padding-left: 4px;
            color: var(--text-main);
        }

        @keyframes blink {
            from, to { border-color: transparent; }
            50% { border-color: var(--text-main); }
        }

        .success { color: var(--text-success); }
        .error { color: var(--text-error); }
        .bright { color: var(--text-main); font-weight: 700; text-transform: uppercase; }

        .continue-btn {
            background: transparent;
            color: var(--text-main);
            border: 1px solid var(--text-main);
            padding: 12px 24px;
            font-family: 'Space Mono', monospace;
            cursor: pointer;
            margin-top: 20px;
            width: fit-content;
            display: block;
            text-transform: uppercase;
        }

        #hidden-field {
            position: fixed; /* Чтобы не влиял на скролл */
            opacity: 0;
            top: 0;
            left: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="terminal" class="terminal-container"></div>
    <input type="text" id="hidden-field" autocomplete="off" spellcheck="false">

    <script>
        const terminal = document.getElementById('terminal');
        const inputField = document.getElementById('hidden-field');
        const charSpeed = 20;
        let isWaitingForInput = false;

        function forceScroll() {
            // Самый жесткий и надежный скролл для мобильного Chrome
            window.scrollTo({
                top: document.documentElement.scrollHeight,
                behavior: 'smooth'
            });
        }

        async function print(text, type = 'default') {
            const el = document.createElement('div');
            el.className = 'line';
            if (type !== 'default') el.classList.add(type);
            terminal.appendChild(el);

            for (let i = 0; i <= text.length; i++) {
                el.textContent = text.substring(0, i);
                // Скроллим реже, чтобы не нагружать процессор
                if (i % 5 === 0) forceScroll();
                await new Promise(r => setTimeout(r, charSpeed));
            }
            forceScroll();
            return el;
        }

        async function loading() {
            const el = document.createElement('div');
            el.className = 'line success';
            terminal.appendChild(el);
            
            for (let i = 0; i < 3; i++) {
                el.textContent = 'loading' + '.'.repeat(i + 1);
                forceScroll();
                await new Promise(r => setTimeout(r, 400));
            }
            terminal.removeChild(el);
        }

        function createPrompt() {
            const wrapper = document.createElement('div');
            wrapper.className = 'prompt-line';
            wrapper.innerHTML = `> enter command: <span id="cursor" class="active-input"></span>`;
            terminal.appendChild(wrapper);
            
            isWaitingForInput = true;
            inputField.value = "";
            inputField.focus();
            setTimeout(forceScroll, 100);
        }

        inputField.addEventListener('input', () => {
            if (!isWaitingForInput) return;
            const cursor = document.getElementById('cursor');
            if (cursor) cursor.textContent = inputField.value.toLowerCase();
            forceScroll();
        });

        // Фокусируемся при любом клике, но не даем странице прыгать
        document.addEventListener('touchstart', (e) => {
            if (e.target.tagName !== 'BUTTON') {
                inputField.focus();
            }
        });

        inputField.addEventListener('keydown', async (e) => {
            if (e.key === 'Enter' && isWaitingForInput) {
                const cmd = inputField.value.toLowerCase().trim();
                const cursor = document.getElementById('cursor');
                
                isWaitingForInput = false;
                if (cursor) {
                    cursor.id = "";
                    cursor.classList.remove('active-input');
                    cursor.style.borderRight = "none";
                }

                if (cmd === 'yes') {
                    await print('system: credentials verified', 'success');
                    await print('welcome to the circuit', 'bright');
                    await loading();
                    await print('alert: critical data corruption detected', 'error');
                    await print('source: absolute_growth_module.bin');
                    await print('restoration requires semantic key');
                    createPrompt();
                } 
                else if (cmd === 'absolute growth') {
                    await print('key accepted. reassembling data fragments', 'success');
                    await loading();
                    await print('status: GROWTH PROTOCOL ACTIVATED', 'success');
                    await print('welcome to the evolution', 'bright');
                    await print('system: final core access is restricted by a temporal marker');
                    await print('the gate will only open when three dragons descend upon the earth');
                    createPrompt();
                } 
                else if (cmd === '1104') {
                    await print('temporal marker detected. system sync complete', 'success');
                    await loading();
                    await print('establishing connection to the core');
                    await print('status: online', 'success');
                    await print('welcome to the dragon tycoon club', 'bright');
                    const btn = document.createElement('button');
                    btn.className = 'continue-btn';
                    btn.textContent = 'CONTINUE';
                    btn.onclick = () => window.location.href = 'gate.html';
                    terminal.appendChild(btn);
                    setTimeout(forceScroll, 100);
                } 
                else {
                    if (cmd !== "") await print('error: access denied', 'error');
                    createPrompt();
                }
            }
        });

        async function init() {
            await print('did you fall into the "hole"?');
            await print('initializing system...', 'success');
            await print('establishing secure connection...', 'success');
            createPrompt();
        }

        window.onload = init;
    </script>
</body>
</html>
